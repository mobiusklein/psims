

<!DOCTYPE html>
<head>
  <meta charset="utf-8">
  
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  
  <title>Usage Examples &mdash; psims  documentation</title>
  

  
  
  
  

  

  
  
    

  

  <link rel="stylesheet" href="../_static/css/theme.min.css" type="text/css" />
  <link rel="stylesheet" href="../_static/css/custom.css" type="text/css" />
  <link rel="stylesheet" href="../_static/pygments.css" type="text/css" />
  <link rel="stylesheet" href="../_static/pygments.css" type="text/css" />
  <link rel="stylesheet" href="../_static/css/theme.min.css" type="text/css" />
    <link rel="index" title="Index" href="../genindex.html" />
    <link rel="search" title="Search" href="../search.html" />
    <link rel="next" title="Components of mzML" href="components.html" />
    <link rel="prev" title="Writing mzML Documents" href="writer.html" /> 

</head>

<body>
    <header>
        <div class="container">
            <a class="site-nav-toggle hidden-lg-up"><i class="icon-menu"></i></a>
            <a class="site-title" href="../index.html">
                psims
            </a>
        </div>
    </header>


<div class="breadcrumbs-outer hidden-xs-down">
    <div class="container">
        















<div role="navigation" aria-label="breadcrumbs navigation">

  <ul class="breadcrumbs">
    
      <li><a href="../index.html">Docs</a></li>
        
          <li><a href="index.html">mzML</a></li>
        
      <li>Usage Examples</li>
    
    
      <li class="breadcrumbs-aside">
        
            
            <a href="../_sources/mzml/examples.rst.txt" rel="nofollow"> View page source</a>
          
        
      </li>
    
  </ul>
</div>
    </div>
</div>
    <div class="main-outer">
        <div class="container">
            <div class="row">
                <div class="col-12 col-lg-3 site-nav">
                    
<div role="search">
    <form class="search" action="../search.html" method="get">
        <div class="icon-input">
            <input type="text" name="q" placeholder="Search" />
            <span class="icon-search"></span>
        </div>
        <input type="submit" value="Go" class="d-hidden" />
        <input type="hidden" name="check_keywords" value="yes" />
        <input type="hidden" name="area" value="default" />
    </form>
</div>
                    <div class="site-nav-tree">
                        
                            
                            
                                <p class="caption" role="heading"><span class="caption-text">Contents:</span></p>
<ul class="current">
<li class="toctree-l1 current"><a class="reference internal" href="index.html">mzML</a><ul class="current">
<li class="toctree-l2"><a class="reference internal" href="writer.html">Writing mzML Documents</a></li>
<li class="toctree-l2 current"><a class="current reference internal" href="#">Usage Examples</a></li>
<li class="toctree-l2"><a class="reference internal" href="components.html">Components of mzML</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="../mzid/index.html">mzIdentML</a><ul>
<li class="toctree-l2"><a class="reference internal" href="../mzid/writer.html">Writing mzIdentML Documents</a></li>
<li class="toctree-l2"><a class="reference internal" href="../mzid/components.html">Components of mzIdentML</a></li>
<li class="toctree-l2"><a class="reference internal" href="../mzid/examples.html">Usage Examples</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="../mzmlb/index.html">mzMLb</a><ul>
<li class="toctree-l2"><a class="reference internal" href="../mzmlb/writer.html">Writing mzMLb Documents</a></li>
<li class="toctree-l2"><a class="reference internal" href="../mzmlb/index.html#references">References</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="../xml.html">XML Utilities</a></li>
<li class="toctree-l1"><a class="reference internal" href="../controlled_vocabulary/index.html">Controlled Vocabularies</a><ul>
<li class="toctree-l2"><a class="reference internal" href="../controlled_vocabulary/controlled_vocabulary.html">Controlled Vocabulary Objects</a></li>
<li class="toctree-l2"><a class="reference internal" href="../controlled_vocabulary/controlled_vocabulary.html#caching">Caching</a></li>
<li class="toctree-l2"><a class="reference internal" href="../controlled_vocabulary/controlled_vocabulary.html#semantic-data">Semantic Data</a></li>
<li class="toctree-l2"><a class="reference internal" href="../controlled_vocabulary/bundled.html">Bundled Controlled Vocabularies</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="../transform/mzml.html">Transforming mzML</a><ul>
<li class="toctree-l2"><a class="reference internal" href="../transform/mzml.html#transforming-mzml-files">Transforming mzML Files</a></li>
<li class="toctree-l2"><a class="reference internal" href="../transform/mzml.html#mzmlb-translation">MzMLb Translation</a></li>
</ul>
</li>
</ul>

                            
                        
                    </div>
                </div>
                <div class="col-12 col-lg-9">
                    <div class="document">
                        
                            
  <div class="section" id="usage-examples">
<h1>Usage Examples<a class="headerlink" href="#usage-examples" title="Permalink to this headline">¶</a></h1>
<div class="section" id="writing-mzml">
<h2>Writing mzML<a class="headerlink" href="#writing-mzml" title="Permalink to this headline">¶</a></h2>
<p>In this example, we’ll walk through the steps involved in writing an mzML file containing simulated data.</p>
<p>Writing an mzML file with <code class="xref py py-mod docutils literal notranslate"><span class="pre">psims</span></code> is done using the <code class="xref py py-class docutils literal notranslate"><span class="pre">MzMLWriter</span></code> class.</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">psims.mzml</span> <span class="kn">import</span> <span class="n">MzMLWriter</span>
</pre></div>
</div>
<p>To begin, you create the writer with a file path, or a previously created file-like object:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">writer</span> <span class="o">=</span> <span class="n">MzMLWriter</span><span class="p">(</span><span class="s2">&quot;path/to/write.mzML&quot;</span><span class="p">)</span>
</pre></div>
</div>
<p>Before any content can be written out, the writer must start the document, which can be done by either
using it as a context manager, or by calling it’s <a class="reference internal" href="writer.html#psims.mzml.writer.IndexedMzMLWriter.begin" title="psims.mzml.writer.IndexedMzMLWriter.begin"><code class="xref py py-meth docutils literal notranslate"><span class="pre">begin()</span></code></a> method.</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="k">with</span> <span class="n">writer</span><span class="p">:</span>
    <span class="n">writer</span><span class="o">.</span><span class="n">controlled_vocabularies</span><span class="p">()</span>
    <span class="o">...</span>
</pre></div>
</div>
<p>The above example uses the context manager syntax, and immediately writes the controlled vocabulary
list to the document. This starts the standard-compliance state-machine, which checks to make sure that
a document proceeds through each section in the expected order, without skipping required sections. The
remainder of these code samples will take place within this context manager.</p>
<p>The next step is to describe the contents of the file to be written. This includes both provenance
information (where the data came from) and classification of the types of spectra contained (MS1 and/or
MSn spectra, centroid vs. profile spectra). In this example, we’ll generate some data <em>de novo</em>, and
so won’t have any <code class="docutils literal notranslate"><span class="pre">&lt;sourceFile&gt;</span></code> elements.</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">writer</span><span class="o">.</span><span class="n">file_description</span><span class="p">([</span> <span class="c1"># the list of file contents terms</span>
    <span class="s2">&quot;MS1 spectrum&quot;</span><span class="p">,</span>
    <span class="s2">&quot;MSn spectrum&quot;</span><span class="p">,</span>
    <span class="s2">&quot;centroid spectrum&quot;</span>
<span class="p">])</span>
</pre></div>
</div>
<p>If a <code class="docutils literal notranslate"><span class="pre">&lt;sourceFile&gt;</span></code> is needed, it can be built using</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">sf</span> <span class="o">=</span> <span class="n">writer</span><span class="o">.</span><span class="n">SourceFile</span><span class="p">(</span><span class="s2">&quot;file://path/to/the&quot;</span><span class="p">,</span> <span class="s2">&quot;file_name.ext&quot;</span><span class="p">,</span> <span class="nb">id</span><span class="o">=</span><span class="s2">&quot;RAW1&quot;</span><span class="p">,</span> <span class="n">params</span><span class="o">=</span><span class="n">params</span><span class="p">)</span>
<span class="c1"># If you need to checksum a local file</span>
<span class="n">sf</span><span class="o">.</span><span class="n">params</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">sf</span><span class="o">.</span><span class="n">checksum</span><span class="p">(</span><span class="s1">&#39;sha-1&#39;</span><span class="p">))</span>
</pre></div>
</div>
<p>The next required list is <code class="docutils literal notranslate"><span class="pre">&lt;softwareList&gt;</span></code>. Replace the names here with your own tools if needed:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">writer</span><span class="o">.</span><span class="n">software_list</span><span class="p">([</span>
    <span class="p">{</span><span class="s2">&quot;id&quot;</span><span class="p">:</span> <span class="s2">&quot;psims-writer&quot;</span><span class="p">,</span>
        <span class="s2">&quot;version&quot;</span><span class="p">:</span> <span class="s2">&quot;0.1.2&quot;</span><span class="p">,</span>
        <span class="s2">&quot;params&quot;</span><span class="p">:</span> <span class="p">[</span>
        <span class="s2">&quot;python-psims&quot;</span><span class="p">,</span>
    <span class="p">]}</span>
<span class="p">])</span>
</pre></div>
</div>
<p>The instrument configuration list is a bit more involved to specify. For example, an ESI FT-ICR
system would be described by:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">source</span> <span class="o">=</span> <span class="n">writer</span><span class="o">.</span><span class="n">Source</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="p">[</span><span class="s2">&quot;electrospray ionization&quot;</span><span class="p">,</span> <span class="s2">&quot;electrospray inlet&quot;</span><span class="p">])</span>
<span class="n">analyzer</span> <span class="o">=</span> <span class="n">writer</span><span class="o">.</span><span class="n">Analyzer</span><span class="p">(</span><span class="mi">2</span><span class="p">,</span> <span class="p">[</span>
        <span class="s2">&quot;&quot;</span><span class="n">fourier</span> <span class="n">transform</span> <span class="n">ion</span> <span class="n">cyclotron</span> <span class="n">resonance</span> <span class="n">mass</span> <span class="n">spectrometer</span><span class="s2">&quot;</span>
    <span class="p">])</span>
<span class="n">detector</span> <span class="o">=</span> <span class="n">writer</span><span class="o">.</span><span class="n">Detector</span><span class="p">(</span><span class="mi">3</span><span class="p">,</span> <span class="p">[</span><span class="s2">&quot;inductive detector&quot;</span><span class="p">])</span>
<span class="n">config</span> <span class="o">=</span> <span class="n">writer</span><span class="o">.</span><span class="n">InstrumentConfiguration</span><span class="p">(</span><span class="nb">id</span><span class="o">=</span><span class="s2">&quot;IC1&quot;</span><span class="p">,</span> <span class="n">component_list</span><span class="o">=</span><span class="p">[</span><span class="n">source</span><span class="p">,</span> <span class="n">analyzer</span><span class="p">,</span> <span class="n">detector</span><span class="p">],</span>
                                        <span class="n">params</span><span class="o">=</span><span class="p">[</span><span class="s2">&quot;LTQ-FT&quot;</span><span class="p">])</span>
<span class="n">writer</span><span class="o">.</span><span class="n">instrument_configuration_list</span><span class="p">([</span><span class="n">config</span><span class="p">])</span>
</pre></div>
</div>
<p>Multiple configurations may be specified.</p>
<p>The <code class="docutils literal notranslate"><span class="pre">&lt;dataProcessing&gt;</span></code> instructions can be as intricate as needed. We’ll throw in some
extra terms for demonstration purposes. Remember, if you used a different software ID
above in the <code class="docutils literal notranslate"><span class="pre">&lt;softwareList&gt;</span></code> section, to use that here too instead of <code class="docutils literal notranslate"><span class="pre">&quot;psims-writer&quot;</span></code>.</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">methods</span> <span class="o">=</span> <span class="p">[]</span>

<span class="n">methods</span><span class="o">.</span><span class="n">append</span><span class="p">(</span>
    <span class="n">writer</span><span class="o">.</span><span class="n">ProcessingMethod</span><span class="p">(</span>
        <span class="n">order</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">sofware_reference</span><span class="o">=</span><span class="s2">&quot;psims-writer&quot;</span><span class="p">,</span> <span class="n">params</span><span class="o">=</span><span class="p">[</span>
            <span class="s2">&quot;Gaussian smoothing&quot;</span><span class="p">,</span>
            <span class="s2">&quot;median baseline reduction&quot;</span><span class="p">,</span>
            <span class="s2">&quot;MS:1000035&quot;</span><span class="p">,</span> <span class="c1"># peak picking</span>
            <span class="s2">&quot;Conversion to mzML&quot;</span>
        <span class="p">]))</span>
<span class="n">processing</span> <span class="o">=</span> <span class="n">writer</span><span class="o">.</span><span class="n">DataProcessing</span><span class="p">(</span><span class="n">methods</span><span class="p">,</span> <span class="nb">id</span><span class="o">=</span><span class="s1">&#39;DP1&#39;</span><span class="p">)</span>
<span class="n">writer</span><span class="o">.</span><span class="n">data_processing_list</span><span class="p">([</span><span class="n">processing</span><span class="p">])</span>
</pre></div>
</div>
<p>Now, we’re nearly ready to start writing spectra. To start, we open the run and spectrum list:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">numpy</span> <span class="k">as</span> <span class="nn">np</span>

<span class="k">with</span> <span class="n">writer</span><span class="o">.</span><span class="n">run</span><span class="p">(</span><span class="nb">id</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">instrument_configuration</span><span class="o">=</span><span class="s1">&#39;IC1&#39;</span><span class="p">):</span>
    <span class="c1"># we will write 3,000 spectra</span>
    <span class="k">with</span> <span class="n">writer</span><span class="o">.</span><span class="n">spectrum_list</span><span class="p">(</span><span class="n">count</span><span class="o">=</span><span class="mf">1e3</span><span class="p">):</span>
        <span class="o">...</span>
</pre></div>
</div>
<p>We write all spectra within the inner context manager of the spectrum list, or instead of
using the context manager notation, call the <a class="reference internal" href="../xml.html#psims.xml.XMLDocumentWriter.begin" title="psims.xml.XMLDocumentWriter.begin"><code class="xref py py-meth docutils literal notranslate"><span class="pre">begin()</span></code></a> and
<a class="reference internal" href="../xml.html#psims.xml.XMLDocumentWriter.end" title="psims.xml.XMLDocumentWriter.end"><code class="xref py py-meth docutils literal notranslate"><span class="pre">end()</span></code></a> methods.</p>
<p>A spectrum is a collection of many complex details. We’ll use <cite>NumPy</cite> arrays
to represent the data arrays. This file contains centroided spectra as previously specified in
the file description.</p>
<p>We’ll assume there’s a function that generates a centroided spectrum, called <code class="docutils literal notranslate"><span class="pre">get_next_arrays</span></code>
to produce those arrays.</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">i</span> <span class="o">=</span> <span class="mi">0</span>
<span class="k">while</span> <span class="n">i</span> <span class="o">&lt;</span> <span class="mf">1e3</span><span class="p">:</span>
    <span class="n">i</span> <span class="o">+=</span> <span class="mi">1</span>
    <span class="n">ms1_mzs</span><span class="p">,</span> <span class="n">ms1_intensities</span> <span class="o">=</span> <span class="n">get_next_arrays</span><span class="p">()</span>
    <span class="n">ms1_spectrum_id</span> <span class="o">=</span> <span class="s2">&quot;index=</span><span class="si">%d</span><span class="s2">&quot;</span> <span class="o">%</span> <span class="n">i</span>
    <span class="n">scan_time</span> <span class="o">=</span> <span class="mf">0.23</span> <span class="o">*</span> <span class="n">i</span>

    <span class="n">writer</span><span class="o">.</span><span class="n">write_spectrum</span><span class="p">(</span>
        <span class="n">ms1_mzs</span><span class="p">,</span> <span class="n">ms1_intensities</span><span class="p">,</span> <span class="nb">id</span><span class="o">=</span><span class="n">ms1_spectrum_id</span><span class="p">,</span> <span class="n">centroided</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
        <span class="n">scan_start_time</span><span class="o">=</span><span class="n">scan_time</span><span class="p">,</span> <span class="n">scan_window_list</span><span class="o">=</span><span class="p">[(</span><span class="mi">0</span><span class="p">,</span> <span class="mf">2000.0</span><span class="p">)],</span>
        <span class="n">params</span><span class="o">=</span><span class="p">[{</span><span class="s2">&quot;ms level&quot;</span><span class="p">:</span> <span class="mi">1</span><span class="p">},</span> <span class="p">{</span><span class="s2">&quot;total ion current&quot;</span><span class="p">:</span> <span class="n">ms1_intensities</span><span class="o">.</span><span class="n">sum</span><span class="p">()}])</span>

    <span class="k">for</span> <span class="n">j</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">3</span><span class="p">):</span>
        <span class="n">i</span> <span class="o">+=</span> <span class="mi">1</span>
        <span class="n">msn_mzs</span><span class="p">,</span> <span class="n">msn_intensities</span> <span class="o">=</span> <span class="n">get_next_arrays</span><span class="p">()</span>
        <span class="n">msn_spectrum_id</span> <span class="o">=</span> <span class="s2">&quot;index=</span><span class="si">%d</span><span class="s2">&quot;</span> <span class="o">%</span> <span class="n">i</span>
        <span class="n">scan_time</span> <span class="o">=</span> <span class="mf">0.23</span> <span class="o">*</span> <span class="n">i</span>

        <span class="n">k</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">randint</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">ms1_mzs</span><span class="p">))</span>
        <span class="n">precursor_info</span> <span class="o">=</span> <span class="p">{</span>
            <span class="s2">&quot;mz&quot;</span><span class="p">:</span> <span class="n">ms1_mzs</span><span class="p">[</span><span class="n">k</span><span class="p">],</span> <span class="s1">&#39;intensity&#39;</span><span class="p">:</span> <span class="n">ms1_intensities</span><span class="p">[</span><span class="n">k</span><span class="p">],</span>
            <span class="s2">&quot;spectrum_reference&quot;</span><span class="p">:</span> <span class="n">ms1_spectrum_id</span><span class="p">,</span>
            <span class="s2">&quot;activation&quot;</span><span class="p">:</span> <span class="p">[</span><span class="s2">&quot;HCD&quot;</span><span class="p">,</span> <span class="p">{</span><span class="s2">&quot;collision energy&quot;</span><span class="p">:</span> <span class="mf">25.0</span><span class="p">}],</span>
            <span class="s2">&quot;isolation_window&quot;</span><span class="p">:</span> <span class="p">(</span><span class="mf">1.0</span><span class="p">,</span> <span class="n">ms1_mzs</span><span class="p">[</span><span class="n">k</span><span class="p">],</span> <span class="mf">1.0</span><span class="p">)</span>
        <span class="p">}</span>


        <span class="n">writer</span><span class="o">.</span><span class="n">write_spectrum</span><span class="p">(</span>
            <span class="n">msn_mzs</span><span class="p">,</span> <span class="n">msn_intensities</span><span class="p">,</span> <span class="nb">id</span><span class="o">=</span><span class="n">msn_spectrum_id</span><span class="p">,</span> <span class="n">centroided</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
            <span class="n">scan_start_time</span><span class="o">=</span><span class="n">scan_time</span><span class="p">,</span> <span class="n">scan_window_list</span><span class="o">=</span><span class="p">[(</span><span class="mi">0</span><span class="p">,</span> <span class="mf">2000.0</span><span class="p">)],</span>
            <span class="n">precursor_information</span><span class="o">=</span><span class="n">precursor_info</span><span class="p">,</span>
            <span class="n">params</span><span class="o">=</span><span class="p">[{</span><span class="s2">&quot;ms level&quot;</span><span class="p">:</span> <span class="mi">2</span><span class="p">},</span> <span class="p">{</span><span class="s2">&quot;total ion current&quot;</span><span class="p">:</span> <span class="n">msn_intensities</span><span class="o">.</span><span class="n">sum</span><span class="p">()}])</span>
</pre></div>
</div>
<p>Similar code can be used for writing chromatograms, see <code class="xref py py-meth docutils literal notranslate"><span class="pre">write_chromatogram()</span></code>.</p>
<p>Once the document is finished, we leave the top-level context manager.</p>
</div>
<div class="section" id="the-complicated-bits">
<h2>The Complicated Bits<a class="headerlink" href="#the-complicated-bits" title="Permalink to this headline">¶</a></h2>
<div class="contents local topic" id="topics">
<p class="topic-title">Topics</p>
<ul class="simple">
<li><p><a class="reference internal" href="#precursor-information" id="id1">Precursor Information</a></p></li>
<li><p><a class="reference internal" href="#binary-data-array-encoding-and-compression" id="id2">Binary Data Array Encoding and Compression</a></p></li>
</ul>
</div>
<div class="section" id="precursor-information">
<h3><a class="toc-backref" href="#id1">Precursor Information</a><a class="headerlink" href="#precursor-information" title="Permalink to this headline">¶</a></h3>
<p>Precursor ions, dissociation/activation information, and isolation windows are really important when
dealing with tandem mass spectra. The <code class="docutils literal notranslate"><span class="pre">&lt;precursor&gt;</span></code> element is pretty complex though, with three
distinct sub-elements, <code class="docutils literal notranslate"><span class="pre">&lt;selectedIon&gt;</span></code>, <code class="docutils literal notranslate"><span class="pre">&lt;isolationWindow&gt;</span></code>, and <code class="docutils literal notranslate"><span class="pre">activation</span></code>, each of which
contains a list of cvParams with varying requirements. <a class="reference internal" href="writer.html#psims.mzml.writer.IndexedMzMLWriter.precursor_builder" title="psims.mzml.writer.IndexedMzMLWriter.precursor_builder"><code class="xref py py-meth docutils literal notranslate"><span class="pre">precursor_builder()</span></code></a>
provides you with an object you can use to incrementally build up the value to provide.</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">precursor</span> <span class="o">=</span> <span class="n">writer</span><span class="o">.</span><span class="n">precursor_builder</span><span class="p">()</span>
<span class="n">si</span> <span class="o">=</span> <span class="n">precursor</span><span class="o">.</span><span class="n">selected_ion</span><span class="p">(</span><span class="n">mz</span><span class="o">=</span><span class="mf">256.05</span><span class="p">)</span>
<span class="n">si</span><span class="o">.</span><span class="n">charge</span> <span class="o">=</span> <span class="mi">2</span>
<span class="n">act</span> <span class="o">=</span> <span class="n">precursor</span><span class="o">.</span><span class="n">activation</span><span class="p">()</span>
<span class="n">act</span><span class="o">.</span><span class="n">add_param</span><span class="p">(</span><span class="s2">&quot;collision-induced dissociation&quot;</span><span class="p">)</span>
<span class="n">act</span><span class="o">.</span><span class="n">add_param</span><span class="p">({</span><span class="s2">&quot;collision energy&quot;</span><span class="p">:</span> <span class="mf">25.0</span><span class="p">})</span>

<span class="n">writer</span><span class="o">.</span><span class="n">write_spectrum</span><span class="p">(</span><span class="o">...</span><span class="p">,</span> <span class="n">precursor_information</span><span class="o">=</span><span class="n">precursor</span><span class="p">)</span>
</pre></div>
</div>
<p>This translates to the following XML:</p>
<div class="highlight-xml notranslate"><div class="highlight"><pre><span></span><span class="nt">&lt;precursorList</span> <span class="na">count=</span><span class="s">&quot;1&quot;</span><span class="nt">&gt;</span>
  <span class="nt">&lt;precursor&gt;</span>
    <span class="nt">&lt;selectedIonList</span> <span class="na">count=</span><span class="s">&quot;1&quot;</span><span class="nt">&gt;</span>
    <span class="nt">&lt;selectedIon&gt;</span>
      <span class="nt">&lt;cvParam</span> <span class="na">cvRef=</span><span class="s">&quot;PSI-MS&quot;</span> <span class="na">accession=</span><span class="s">&quot;MS:1000744&quot;</span> <span class="na">name=</span><span class="s">&quot;selected ion m/z&quot;</span> <span class="na">value=</span><span class="s">&quot;256.05&quot;</span> <span class="na">unitCvRef=</span><span class="s">&quot;PSI-MS&quot;</span> <span class="na">unitAccession=</span><span class="s">&quot;MS:1000040&quot;</span> <span class="na">unitName=</span><span class="s">&quot;m/z&quot;</span><span class="nt">/&gt;</span>
      <span class="nt">&lt;cvParam</span> <span class="na">cvRef=</span><span class="s">&quot;PSI-MS&quot;</span> <span class="na">accession=</span><span class="s">&quot;MS:1000042&quot;</span> <span class="na">name=</span><span class="s">&quot;peak intensity&quot;</span> <span class="na">value=</span><span class="s">&quot;0.0&quot;</span> <span class="na">unitCvRef=</span><span class="s">&quot;PSI-MS&quot;</span> <span class="na">unitAccession=</span><span class="s">&quot;MS:1000131&quot;</span> <span class="na">unitName=</span><span class="s">&quot;number of detector counts&quot;</span><span class="nt">/&gt;</span>
      <span class="nt">&lt;cvParam</span> <span class="na">cvRef=</span><span class="s">&quot;PSI-MS&quot;</span> <span class="na">accession=</span><span class="s">&quot;MS:1000041&quot;</span> <span class="na">name=</span><span class="s">&quot;charge state&quot;</span> <span class="na">value=</span><span class="s">&quot;2&quot;</span><span class="nt">/&gt;</span>
    <span class="nt">&lt;/selectedIon&gt;</span>
    <span class="nt">&lt;/selectedIonList&gt;</span>
    <span class="nt">&lt;activation&gt;</span>
    <span class="nt">&lt;cvParam</span> <span class="na">cvRef=</span><span class="s">&quot;PSI-MS&quot;</span> <span class="na">accession=</span><span class="s">&quot;MS:1000133&quot;</span> <span class="na">name=</span><span class="s">&quot;collision-induced dissociation&quot;</span> <span class="na">value=</span><span class="s">&quot;&quot;</span><span class="nt">/&gt;</span>
    <span class="nt">&lt;cvParam</span> <span class="na">cvRef=</span><span class="s">&quot;PSI-MS&quot;</span> <span class="na">accession=</span><span class="s">&quot;MS:1000045&quot;</span> <span class="na">name=</span><span class="s">&quot;collision energy&quot;</span> <span class="na">value=</span><span class="s">&quot;25.0&quot;</span> <span class="na">unitCvRef=</span><span class="s">&quot;UO&quot;</span> <span class="na">unitAccession=</span><span class="s">&quot;UO:0000266&quot;</span> <span class="na">unitName=</span><span class="s">&quot;electronvolt&quot;</span><span class="nt">/&gt;</span>
    <span class="nt">&lt;/activation&gt;</span>
  <span class="nt">&lt;/precursor&gt;</span>
<span class="nt">&lt;/precursorList&gt;</span>
</pre></div>
</div>
<p>Alternatively, you can pass these arguments to <a class="reference internal" href="writer.html#psims.mzml.writer.IndexedMzMLWriter.prepare_precursor_information" title="psims.mzml.writer.IndexedMzMLWriter.prepare_precursor_information"><code class="xref py py-meth docutils literal notranslate"><span class="pre">prepare_precursor_information()</span></code></a>
to go through the same value translation. This will be done automatically when a <a class="reference external" href="https://docs.python.org/3/library/stdtypes.html#dict" title="(in Python v3.11)"><code class="xref py py-class docutils literal notranslate"><span class="pre">dict</span></code></a> was passed as the <cite>precursor_information</cite> argument to
<a class="reference internal" href="writer.html#psims.mzml.writer.IndexedMzMLWriter.spectrum" title="psims.mzml.writer.IndexedMzMLWriter.spectrum"><code class="xref py py-meth docutils literal notranslate"><span class="pre">spectrum()</span></code></a>/<a class="reference internal" href="writer.html#psims.mzml.writer.IndexedMzMLWriter.write_spectrum" title="psims.mzml.writer.IndexedMzMLWriter.write_spectrum"><code class="xref py py-meth docutils literal notranslate"><span class="pre">write_spectrum()</span></code></a>.</p>
</div>
<div class="section" id="binary-data-array-encoding-and-compression">
<h3><a class="toc-backref" href="#id2">Binary Data Array Encoding and Compression</a><a class="headerlink" href="#binary-data-array-encoding-and-compression" title="Permalink to this headline">¶</a></h3>
<p>It’s arguable that the binary data arrays account for the majority of the space used by mzML files, and are an
important piece of content. These numerical arrays are encoded using specific precision types and compression
schemes. The standard practice is to encode m/z arrays using 64-bit floating point numbers and everything else
using 32-bit floating point numbers or integers where appropriate.</p>
<p>To configure the encoding of a particular array, when calling <a class="reference internal" href="writer.html#psims.mzml.writer.IndexedMzMLWriter.spectrum" title="psims.mzml.writer.IndexedMzMLWriter.spectrum"><code class="xref py py-meth docutils literal notranslate"><span class="pre">spectrum()</span></code></a>,
<code class="xref py py-meth docutils literal notranslate"><span class="pre">chromatogram()</span></code>, you may pass an <code class="docutils literal notranslate"><span class="pre">encoding</span></code> <a class="reference external" href="https://docs.python.org/3/library/stdtypes.html#dict" title="(in Python v3.11)"><code class="xref py py-class docutils literal notranslate"><span class="pre">dict</span></code></a> parameter which maps
array type to encoding data type. By default, this will map <code class="docutils literal notranslate"><span class="pre">m/z</span> <span class="pre">array</span></code> to 64-bit float and <code class="docutils literal notranslate"><span class="pre">charge</span> <span class="pre">array</span></code>
to 32-bit integer and all other arrays will map to 32-bit float.</p>
<p>The mzML standard specifies a binary data array may be compressed too. The <code class="docutils literal notranslate"><span class="pre">compression</span></code> argument controls which
method is used. The default method is <code class="docutils literal notranslate"><span class="pre">zlib</span></code> compression, see the <a class="reference internal" href="writer.html#psims.mzml.writer.compression_map" title="psims.mzml.writer.compression_map"><code class="xref py py-obj docutils literal notranslate"><span class="pre">compression_map</span></code></a> attribute
of the <a class="reference internal" href="writer.html#module-psims.mzml.writer" title="psims.mzml.writer"><code class="xref py py-mod docutils literal notranslate"><span class="pre">psims.mzml.writer</span></code></a> module. <code class="docutils literal notranslate"><span class="pre">zlib</span></code> is a lossless compression scheme, but can be slow, while the MS-Numpress
compression methods are able to reduce the size of the data by altering the binary composition prior to base64 encoding
at the cost of losing some precision. MS-Numpress methods also require the <code class="xref py py-mod docutils literal notranslate"><span class="pre">pynumpress</span></code> library be installed.</p>
</div>
</div>
</div>


                        
                    </div>
                </div>
            </div>
        </div>
    </div>    


  

    <script type="text/javascript">
        var DOCUMENTATION_OPTIONS = {
            URL_ROOT:'../',
            VERSION:'',
            LANGUAGE:'None',
            COLLAPSE_INDEX:false,
            FILE_SUFFIX:'.html',
            HAS_SOURCE:  true,
            SOURCELINK_SUFFIX: '.txt'
        };
    </script>
    <script type="text/javascript" src="../_static/documentation_options.js"></script>
    <script type="text/javascript" src="../_static/jquery.js"></script>
    <script type="text/javascript" src="../_static/underscore.js"></script>
    <script type="text/javascript" src="../_static/doctools.js"></script>
    <script type="text/javascript" src="../_static/js/theme.js"></script>
  
    <div class="footer" role="contentinfo">
        <div class="container">
            &#169; Copyright 2018, Joshua Klein.
        Created using <a href="http://sphinx-doc.org/">Sphinx</a> 4.2.0.
        </div>
    </div>  

</body>
</html>